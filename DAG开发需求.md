# AI-MATH DAG探索历史可视化设计（最终版）

根据您的补充和修改要求，我将为您提供一个完善的DAG探索历史功能的最终设计方案。

## 1. 整体布局设计

### 基本布局结构
- **DAG可视化区**：位于页面左侧，占据约30%宽度
  - 紧贴页面左侧边缘
  - 随页面滚动而移动，始终保持可见
  - 采用纵向布局，展示解题的完整探索树

- **解题内容区**：位于页面右侧，占据约70%宽度
  - 显示当前选中路径的解题步骤
  - 包含题目和所有解题块

### 视图控制
- **展开/收起控制**：
  - DAG区域顶部有"展开/收起"按钮
  - 默认状态：占据左侧30%宽度
  - 展开状态：向右扩展至占据页面约70-80%，主内容区收缩
  - 收起状态：可最小化为窄条，临时增大工作区

- **DAG随滚动特性**：
  - DAG视图区与主内容区独立滚动
  - DAG始终可见，不受主内容区滚动影响
  - 可选择"锁定DAG"使其位置固定

## 2. DAG节点与边的可视化设计

### 节点设计
- **基本形状**：所有节点采用圆角矩形设计
  - 节点尺寸相对较大，便于展示信息
  - 节点内包含简短的步骤描述或预览
  - 特殊节点区分：
    - 起始节点（题目）：独特颜色或标记
    - 终止节点（完成解答）：星形标记或特殊边框

- **节点状态表示**：
  - 正确步骤：绿色边框/背景
  - 错误步骤：红色边框/背景
  - 未验证步骤：灰色或中性色
  - 当前活动节点：蓝色高亮或加粗边框
  - 用户高亮标记：自定义颜色边框或背景

- **节点内容**：
  - 显示步骤编号和简短描述
  - 包含步骤正确性图标（✓/✗/？）
  - 可选显示数学公式预览

### 边的设计
- **连接方式**：
  - 使用有向箭头清晰表示步骤流向
  - 主解题路径：粗线条显示
  - 其他探索路径：细线条显示
  - 成功解题路径：绿色线条带柔和光晕
  - 注意不标记错误路径（因为可能后续步骤能成功）

- **布局规则**：
  - 采用分层自上而下或自左向右布局
  - 尽量减少边的交叉
  - 相关分支尽量靠近排列

## 3. 交互功能设计

### 节点交互
- **悬停交互**：
  - 鼠标悬停显示步骤简要预览
  - 提供"展开"选项查看完整内容
  - 显示相关元数据（创建时间、状态等）

- **左键点击**：
  - 加载该节点对应的完整解题路径
  - 在主内容区显示从起始到该节点的所有步骤
  - 高亮显示该节点在DAG中的位置

- **右键菜单选项**：
  - "添加备注信息"：为节点添加个人注释
  - "思路解读"：添加对该思路的分析（可以是正确或错误的）
  - "标记高亮"：为重要节点添加自定义颜色标记
  - "从此处开始新路径"：基于当前节点创建新的探索分支
  - 复制当前信息和复制全部信息
  
### 路径管理
- **路径高亮**：
  - 当前活动路径使用粗线高亮显示
  - 成功解题路径用绿色光晕标记（不刺眼）
  - 可手动高亮特定路径进行关注

- **路径过滤**：
  - 提供过滤器只显示特定类型的路径
  - 可按状态筛选（完成/未完成）
  - 可按创建时间筛选

- **新分支创建**：
  - 可从任意节点创建新分支
  - 新分支继承父节点之前的所有步骤
  - 系统自动为分支点添加视觉标记

## 4. 数据结构与实现细节

### 节点数据模型
```javascript
{
  id: "node_123",              // 唯一标识符
  type: "step",                // 节点类型：题目/步骤/解答
  content: {                   // 节点内容
    latex: "\\int_{0}^{\\pi/2} \\sin^2(x) \\, dx = \\frac{\\pi}{4}",
    stepNumber: 3,
    description: "应用二倍角公式"
  },
  status: "correct",           // 状态：correct/incorrect/unverified
  metadata: {
    createdAt: "timestamp",    // 创建时间
    modifiedAt: "timestamp",   // 修改时间
    notes: "用户笔记",          // 用户添加的备注
    highlight: "#ffdd00",      // 用户自定义高亮颜色
    tags: ["重要", "关键步骤"]  // 用户添加的标签
  },
  visualization: {
    position: {x: 100, y: 200},// 节点在画布中的位置
    expanded: false            // 节点是否处于展开状态
  }
}
```

### 边数据模型
```javascript
{
  id: "edge_456",              // 唯一标识符
  source: "node_123",          // 起始节点ID
  target: "node_789",          // 目标节点ID
  pathId: "path_001",          // 所属路径ID
  type: "main",                // 边类型：main/alternative
  metadata: {
    createdAt: "timestamp"     // 创建时间
  },
  visualization: {
    style: "solid",            // 线条样式：solid/dashed
    width: 2,                  // 线条宽度
    color: "#00ff00"           // 线条颜色
  }
}
```

### 路径数据模型
```javascript
{
  id: "path_001",              // 唯一标识符
  name: "主解题路径",           // 路径名称
  nodes: ["node_123", ...],    // 包含的节点ID列表
  status: "completed",         // 状态：completed/in_progress/failed
  metadata: {
    createdAt: "timestamp",    // 创建时间
    completedAt: "timestamp",  // 完成时间
    notes: "用户对路径的笔记"   // 用户添加的路径笔记
  }
}
```

## 5. 渲染实现方案

### 技术选择
- 使用SVG或Canvas技术实现DAG可视化
- 采用D3.js等成熟图形库处理复杂布局
- 实现自定义布局算法处理数学解题特有的树状结构

### 布局算法
- 主要采用分层布局（Hierarchical Layout）
- 路径之间保持适当间距，减少视觉干扰
- 支持节点拖拽调整，实现半自动布局

### 性能优化
- 大型DAG支持视图聚焦与缩放
- 实现节点折叠机制，简化复杂图形
- 视野外节点可延迟渲染，提高性能

## 6. 用户场景流程

### 场景一：开始新的探索分支
1. 用户在解题过程中想尝试不同方法
2. 右键点击当前节点，选择"从此处开始新路径"
3. 系统创建新的分支点，并复制之前的步骤
4. 用户在新分支上继续探索
5. DAG实时更新，显示新的探索路径
6. 如果新路径成功解答，系统添加一条到终点星形的连接，并标记为绿色

### 场景二：比较不同解法步骤
1. 用户在DAG中看到多条解题路径
2. 点击某个特定节点，加载对应路径
3. 右侧显示该路径的完整解题步骤
4. 用户添加备注，标记重要思路节点
5. 为常用的解题模式添加高亮标记，便于日后参考

### 场景三：使用DAG进行教学
1. 教师预先准备多种解法的DAG
2. 在教学过程中展示不同思路路径
3. 高亮关键步骤，添加思路解读
4. 学生可以看到成功路径与失败尝试
5. 帮助学生理解不同解题思路的优缺点

## 7. 特殊功能与未来扩展

### 特殊功能
- **节点对比**：选择两个节点，显示它们之间的差异（未来版本实现）
- **路径合并**：将多条路径的优点合并为新路径（未来版本实现）
- **思路模板**：将成功路径保存为模板，应用于类似问题

### 数据存储与共享
- 本地保存解题DAG历史
- 支持导出/导入DAG数据
- 可选择共享特定解题路径

### 未来扩展
- 添加路径相似度分析
- 集成机器学习推荐最优解法
- 支持团队协作解题，多人共同构建DAG

## 8. 界面设计注意事项

- 保持界面简洁明了，避免视觉干扰
- 提供充分的视觉反馈，清晰表示当前状态
- 设计适当的引导和提示，帮助用户理解DAG
- 确保颜色选择考虑色盲用户的可访问性
- 提供键盘快捷键支持专业用户高效操作

这个DAG探索历史功能的设计将使AI-MATH平台成为一个更强大的数学学习和探索工具，帮助用户更好地理解数学问题的多种解法和思路发展过程。



特别的，如果产生了拆分，那么块应该变成2块，DAG中也永久的变成2块。
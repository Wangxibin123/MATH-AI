# AI-MATH 完整界面设计与交互模型详细说明

## 1. 整体界面结构与布局

### 1.1 基础布局划分
- **左侧DAG可视化区**：占据页面宽度约27.5%，可展开/收起，展开时最大可占70%
- **中间解题工作区**：占据页面宽度约45%，包含题目块和解答块区域
- **右侧AI模型面板区**：占据页面宽度约22.5%，包含三个可切换的AI辅助面板

### 1.2 响应式布局调整
- **默认状态**：左(27.5%) + 中(45%) + 右(22.5%)
- **DAG展开状态**：DAG(70%) + 中(30%) + 右(最小化)
- **AI面板激活状态**：左(图标) + 中(50%) + 激活的AI面板(50%)
- **移动端**：组件自动堆叠，按钮纵向排列

### 1.3 顶部导航与控制区
- 左侧：DAG展开/收起按钮
- 中间：页面标题"AI-MATH"
- 右侧：AI模型面板切换按钮

## 2. DAG探索历史可视化设计详解

### 2.1 基本结构与功能
- **位置**：页面左侧，默认占27.5%宽度
- **状态切换**：可通过顶部按钮展开至70%或收起为图标
- **独立滚动**：与主内容区独立滚动，保持视图可见性

### 2.2 节点设计与表示
- **形状**：圆角矩形，包含步骤简要信息
- **状态标识**：
  - 正确步骤：绿色边框/背景
  - 错误步骤：红色边框/背景
  - 未验证步骤：灰色或中性色
  - 当前活动节点：蓝色高亮或加粗边框
- **特殊节点**：
  - 起始节点（题目）：特殊颜色/形状
  - 终止节点（完成解答）：星形标记
  - 拆分节点：特殊分叉标记

### 2.3 边的设计与路径表示
- **连接方式**：有向箭头清晰表示解题流向
- **路径样式**：
  - 当前解题路径：粗线表示
  - 成功解题路径：绿色线条（带光晕）
  - 其他探索路径：细线条
  - 拆分路径：特殊虚线样式

### 2.4 交互功能
- **节点悬停**：显示步骤预览和操作选项
- **节点点击**：加载该节点对应的完整解题路径
- **右键菜单**：
  - 添加备注信息
  - 思路解读
  - 标记高亮（可选择颜色）
  - 从此处开始新路径
  - 复制当前/全部信息
- **拖拽调整**：可手动调整节点位置
- **复制到AI面板**：可将节点拖拽或复制到右侧AI面板进行分析

### 2.5 数据结构与存储
- **节点数据模型**：包含ID、内容、状态、元数据等
- **边数据模型**：定义节点间连接关系
- **路径数据模型**：记录完整解题路径信息
- **本地存储**：支持保存和恢复解题历史

### 2.6 DAG模式切换
- **DAG展开时的三种模式**：通过右上角三个小按钮切换
  1. **原始解题列表模式**：显示与中间解题区对应的列表视图
  2. **问题探索模式**：连接提问型大模型，用于深入探讨解题思路
  3. **总结归纳模式**：连接总结型大模型，用于概括和归纳解题过程

## 3. 中间解题工作区设计详解

### 3.1 题目块设计
- **结构**：左侧标识+内容区+按钮区
- **按钮**：编辑(✏️)和上传(📷)
- **状态切换**：
  - 默认状态：显示渲染后的LaTeX数学题目
  - 编辑模式：LaTeX代码编辑框
  - 图片上传模式：OCR识别转LaTeX

### 3.2 解答块设计
- **基本结构**：
  - 序号标识（左侧圆形编号）
  - 正确性标记（右上角✅/❌）
  - 内容区（渲染后的LaTeX）
  - 按钮区（编辑✏️、删除🗑️、解析🔍）
- **解析功能**：
  - 系统验证正确性
  - 展开解析面板（概念、关键点、推导细节/错误）
  - 折叠/展开控制
- **编辑功能**：
  - LaTeX代码编辑
  - 保存、拆分、删除、解析选项
- **拆分功能**：
  - 自动分为两部分
  - 确认后生成两个新块
  - 在DAG中形成分叉
- **删除功能**：
  - 删除当前及后续块
  - 大量删除时有确认提示
  - 所有删除可在DAG中追溯
- **块引用标识**：
  - 每个块有唯一数字ID（如@1, @2）
  - 可在AI面板中通过@符号快速引用

### 3.3 操作区设计
- **布局**：`[类似题📚] [文本输入框] [提交/全部解答🖊] [AI提示💡] [步骤分析🔬] [总结📝]`
- **输入框**：占据大部分宽度，用于输入下一步解答
- **按钮功能**：
  - 类似题：调用RAG检索相关题目
  - 提交/全部解答：根据输入框状态切换
  - AI提示：提供下一步解题提示
  - 步骤分析：拆分并解析子步骤
  - 总结：生成解题过程总结

### 3.4 特殊交互功能
- **最终答案标记**：使用`\boxed{}`居中显示
- **块间交互**：支持拖拽调整顺序
- **拆分机制**：拆分后永久形成两个解答块，DAG中也形成两个节点
- **拖拽到AI面板**：解答块可拖拽到右侧AI面板进行深入分析

## 4. 右侧AI模型面板详解

### 4.1 三面板设计
- **占比**：默认状态下占页面宽度的22.5%
- **布局**：三个垂直排列的独立面板
- **面板类型**：
  1. **LaTeX格式化面板**（顶部）：专注于数学表达式处理
  2. **解释分析面板**（中部）：提供详细解释和思路分析
  3. **总结归纳面板**（底部）：生成解题过程的总结与归纳

### 4.2 LaTeX格式化面板
- **功能定位**：专门处理数学表达式的格式化和优化
- **核心功能**：
  - 将手写或不规范的数学表达式转换为标准LaTeX
  - 提供数学表达式的简化建议
  - 格式化复杂公式，提高可读性
- **界面设计**：
  - 顶部：功能切换按钮和标题
  - 中部：输入/输出显示区
  - 底部：操作按钮（应用、复制、回退）
- **块引用功能**：
  - 文本框上方显示块引用选择区
  - 支持@符号引用特定块（如@3表示第3块）
  - 支持范围引用（如@1-8表示第1到第8块）
  - 支持选择性引用（如@3-6表示第3到第6块）

### 4.3 解释分析面板
- **功能定位**：提供深入的解题思路和数学概念解释
- **核心功能**：
  - 详细解释解题步骤的理论依据
  - 提供相关数学概念的详细说明
  - 分析错误并提供改进建议
- **界面设计**：
  - 顶部：功能切换按钮和标题
  - 中部：解释内容显示区（支持层级结构）
  - 底部：反馈和深入分析选项
- **块引用功能**：
  - 与LaTeX面板相同的引用机制
  - 可一次性分析多个连续步骤

### 4.4 总结归纳面板
- **功能定位**：整合和概括整个解题过程
- **核心功能**：
  - 生成解题思路概要
  - 提取关键数学概念和技巧
  - 比较不同解题路径的优缺点
- **界面设计**：
  - 顶部：功能标题和控制按钮
  - 中部：总结内容显示区
  - 底部：分享和导出选项
- **块引用功能**：
  - 完整支持@符号引用机制
  - 默认分析整个解题过程

### 4.5 面板激活与交互
- **激活方式**：
  - 拖拽解题块到面板
  - 点击面板顶部的激活按钮
  - 使用@符号引用块
- **激活状态变化**：
  - 激活面板扩展至50%宽度
  - 中间解题区收缩至50%宽度
  - DAG区域自动折叠为图标
- **面板间切换**：
  - 顶部提供切换按钮
  - 支持快捷键切换
  - 拖拽内容到另一面板

### 4.6 块引用系统详解
- **引用语法**：
  - **单块引用**：@n（如@3引用第3个块）
  - **全前序引用**：@1-n（如@1-8引用第1到第8块）
  - **指定范围引用**：@m-n（如@3-6引用第3到第6块）
- **快捷引用UI**：
  - 文本框上方显示当前可用块的缩略图
  - 点击缩略图自动插入对应@引用
  - 鼠标拖选多个缩略图插入范围引用
- **引用显示**：
  - 引用的块在AI面板中以引用样式显示
  - 引用内容可展开/折叠
  - 支持在引用内容上直接添加注释

## 5. 跨组件交互流程

### 5.1 拖拽与@引用解答块
- **拖拽操作流程**：
  1. 用户在中间区域选中解答块
  2. 拖动至右侧AI面板（LaTeX/解释/总结）
  3. 目标面板激活并扩展至50%宽度
  4. 中间区域调整为50%宽度
  5. DAG自动折叠为图标状态
- **@引用操作流程**：
  1. 用户在AI面板输入框中输入@符号
  2. 显示可引用块的下拉列表
  3. 选择或输入具体块编号/范围（如@3或@1-8）
  4. 系统自动将引用内容插入面板

### 5.2 DAG与AI面板的互动
- **DAG展开时的模式切换**：
  1. 右上角三个按钮分别对应三种模式
  2. 点击按钮切换当前DAG与相应AI功能的连接
  3. 切换后右侧30%区域显示对应的功能界面
- **DAG节点到AI面板的转移**：
  1. 用户可从DAG中选择并复制节点
  2. 将节点拖拽到右侧AI面板
  3. 或使用右键菜单选择"发送到AI分析"

### 5.3 拆分操作的跨组件响应
- **操作触发**：
  1. 用户在解答块中点击"拆分"按钮
  2. 系统显示拆分编辑界面
  3. 用户确认拆分操作
- **跨组件响应**：
  - 解题区：一个块变为两个独立块，编号自动调整
  - DAG区：生成新的分叉节点和路径
  - AI面板：@引用系统自动更新编号

### 5.4 布局状态转换流程
- **默认→DAG展开**：
  1. 用户点击DAG展开按钮
  2. DAG区域扩展至70%宽度
  3. 中间区域收缩至30%
  4. 右侧显示当前选择的AI功能(30%)，提供三个模式切换按钮
- **默认→AI面板激活**：
  1. 用户拖拽解答块到AI面板或使用@引用
  2. 左侧DAG折叠为图标
  3. 中间区域调整为50%宽度
  4. 激活的AI面板扩展至50%宽度
- **AI面板激活→默认**：
  1. 用户点击面板顶部的关闭按钮
  2. 布局恢复为默认状态
  3. DAG区域可选择性展开

## 6. 用户界面细节与交互元素

### 6.1 块引用选择器设计
- **位置**：AI面板文本输入框上方
- **外观**：水平滚动条显示当前解题块的缩略图
- **交互方式**：
  - 点击单个缩略图：插入单块引用（如@3）
  - 拖选多个缩略图：插入范围引用（如@3-6）
  - 点击"全部"按钮：插入从第一块到当前块的引用（如@1-8）
- **视觉反馈**：
  - 已选择的块高亮显示
  - 鼠标悬停时显示块ID和内容预览
  - 引用成功后缩略图短暂变色确认

### 6.2 DAG模式切换按钮组
- **位置**：DAG展开状态下右上角
- **设计**：三个并排的图标按钮
  - 第一个按钮：表格/列表图标（原始解题列表）
  - 第二个按钮：问号/对话图标（问题探索）
  - 第三个按钮：概要/总结图标（总结归纳）
- **状态指示**：当前激活的模式按钮高亮显示
- **切换效果**：切换按钮后，右侧30%区域平滑过渡到对应界面

### 6.3 AI面板标识与切换
- **面板标识**：
  - LaTeX格式化面板：数学符号/公式图标
  - 解释分析面板：放大镜/问号图标
  - 总结归纳面板：折线图/概要图标
- **面板切换控制**：
  - 面板间的分隔条可拖动调整各面板高度
  - 点击面板标题栏可展开/折叠面板
  - 双击面板标题栏可最大化该面板

### 6.4 块间关系指示器
- **引用关系指示**：
  - 当使用@引用时，被引用的块在中间区域高亮标记
  - 引用线条连接AI面板和被引用块
- **依赖关系指示**：
  - 块之间的数学逻辑依赖关系以细线连接
  - 鼠标悬停在块上时，相关依赖块轻微高亮

### 6.5 交互状态与反馈
- **拖拽状态**：
  - 开始拖拽时块略微抬起（阴影效果）
  - 拖拽过程中显示可放置区域高亮指示
  - 成功放置时有确认动画
- **操作确认**：
  - 重要操作（如删除多个块）有确认对话框
  - 操作成功有短暂的成功提示
  - 操作失败有明确的错误信息

## 7. 实现与技术细节

### 7.1 前端框架选择
- **主框架**：React.js用于组件化开发
- **状态管理**：Redux或Context API管理复杂状态
- **样式方案**：Tailwind CSS和styled-components结合使用

### 7.2 DAG可视化实现
- **技术选择**：D3.js或Cytoscape.js实现图形可视化
- **布局算法**：分层布局(Hierarchical Layout)与自定义数学解题布局
- **性能优化**：
  - 大型DAG视图聚焦与缩放
  - 视野外节点延迟渲染
  - 节点折叠机制

### 7.3 数学公式渲染
- **LaTeX渲染**：使用KaTeX或MathJax处理数学公式
- **实时预览**：编辑时实时渲染预览
- **格式化工具**：提供自动格式化和美化

### 7.4 AI模型集成
- **API连接**：与后端AI模型服务集成
- **三种模型角色**：
  1. LaTeX优化器：专注于公式格式化和简化
  2. 解析专家：提供数学概念和推导解释
  3. 总结生成器：归纳和概括解题路径
- **异步处理**：
  - 非阻塞式API调用
  - 进度指示器显示处理状态
  - 结果缓存减少重复请求

### 7.5 @引用系统实现
- **解析机制**：
  - 正则表达式识别@引用格式
  - 支持数字、范围和多选格式
- **引用渲染**：
  - 引用内容实时同步更新
  - 高性能渲染避免重复计算
- **错误处理**：
  - 无效引用有明确提示
  - 自动修正常见引用错误

## 8. 用户场景与工作流程

### 8.1 基础解题流程
1. 用户输入或上传新题目
2. 系统解析并显示LaTeX渲染后的题目
3. 用户在输入框中输入第一步解答
4. 点击"提交"生成第一个解答块
5. 系统自动验证并在DAG中记录
6. 重复步骤3-5直至解题完成
7. 最终答案以`\boxed{}`形式显示

### 8.2 使用AI辅助解题流程
1. 用户在解题过程中遇到困难
2. 将特定解答块拖至解释面板或使用@引用
3. AI提供详细解释或建议
4. 用户根据建议继续解题
5. 系统在DAG中记录AI辅助痕迹

### 8.3 多路径探索流程
1. 用户想尝试不同解法
2. 在DAG中右键点击特定节点
3. 选择"从此处开始新路径"
4. 系统创建新分支，复制之前步骤
5. 用户在新分支上继续探索
6. DAG实时更新显示多条解题路径
7. 用户可以比较不同路径的优劣

### 8.4 块引用分析流程
1. 用户想分析特定解题步骤或过程
2. 在AI面板中使用@符号引用相关块
   - @3：分析第3块
   - @1-8：分析第1到第8块全部内容
   - @3-6：仅分析第3到第6块
3. AI模型处理引用内容并提供分析
4. 用户可基于分析结果修改或优化解题步骤

### 8.5 DAG模式切换工作流
1. 用户展开DAG区域（占70%宽度）
2. 右上角显示三个模式切换按钮
3. 用户选择需要的模式：
   - 原始解题列表：查看当前解题步骤
   - 问题探索：深入分析特定解题思路
   - 总结归纳：获取整体解题概要
4. 右侧30%区域显示对应功能界面
5. 用户可在DAG中选择节点并复制到右侧面板

## 9. 视觉设计与用户体验

### 9.1 色彩系统
- **主色调**：蓝色系（#1976D2）表示主要操作和活跃状态
- **辅助色**：
  - 绿色（#4CAF50）表示正确/成功
  - 红色（#F44336）表示错误/失败
  - 灰色（#9E9E9E）表示中性/未确认
- **背景色**：
  - 白色/浅灰为主要背景
  - 浅蓝作为DAG区域背景
  - 不同AI面板有轻微色彩区分

### 9.2 排版与可读性
- **字体选择**：无衬线字体保证跨平台可读性
- **数学排版**：遵循标准数学排版规范
- **空间利用**：
  - 合理的边距和间距
  - 可折叠元素节省空间
  - 自适应布局适应不同屏幕尺寸

### 9.3 交互指引与反馈
- **新手引导**：首次使用提供功能引导
- **操作提示**：关键功能处显示简要提示
- **快捷键提示**：常用操作显示对应快捷键
- **状态变化**：所有操作有明确视觉反馈

### 9.4 动画与过渡效果
- **布局转换**：平滑的布局调整动画
- **面板激活**：面板展开有流畅过渡
- **内容加载**：适当的加载指示与骨架屏
- **引用连接**：引用关系有动态连线效果

## 10. 系统性能与优化

### 10.1 渲染优化
- **LaTeX渲染**：
  - 大型公式分块渲染
  - 公式缓存减少重复计算
  - 可见区域优先渲染
- **DAG渲染**：
  - 大型DAG视图虚拟化
  - 节点按需加载
  - 细节层级随缩放变化

### 10.2 响应性能
- **UI线程优化**：
  - 耗时计算移至Web Worker
  - 批量DOM更新减少重排
  - 防抖和节流处理频繁事件
- **API调用优化**：
  - 请求合并减少网络往返
  - 结果缓存避免重复请求
  - 预加载可能需要的数据

### 10.3 存储与同步
- **本地存储**：
  - IndexedDB存储大型解题历史
  - LocalStorage保存用户偏好
  - SessionStorage维护会话状态
- **云同步**：
  - 增量同步减少数据传输
  - 冲突解决策略
  - 离线工作支持

## 11. 未来扩展与进阶功能

### 11.1 协作与社区
- **解题路径分享**：生成可分享链接
- **团队协作**：多用户同时编辑
- **社区解法库**：优秀解法收集与分享

### 11.2 学习分析
- **错误分析**：识别常见错误模式
- **学习曲线**：跟踪解题能力进步
- **推荐系统**：基于水平推荐练习题

### 11.3 教学工具
- **讲解模式**：教师引导解题过程
- **题目生成**：根据概念自动生成练习
- **考试准备**：针对性训练薄弱环节

## 总结

AI-MATH系统通过独特的三区块设计（左侧DAG可视化、中间解题工作区、右侧AI模型面板）创建了一个强大而灵活的数学解题环境。系统的核心创新在于：

1. **多维度解题探索**：通过DAG可视化支持多路径解题探索和比较
2. **智能块引用系统**：@引用语法（@n、@1-n、@m-n）让用户精确指定分析内容
3. **三重AI辅助**：专业化的LaTeX格式化、解释分析和总结归纳功能
4. **灵活布局切换**：根据当前任务动态调整界面布局
5. **完整数学学习生态**：从问题输入到解答、验证、优化和总结的全流程支持

这一设计不仅满足了数学解题的技术需求，还通过直观的可视化和智能辅助功能，降低了数学学习的认知门槛，为用户提供了一个集探索、学习和创新于一体的数学解题平台。



以下是几个关键UI场景的示意图描述：
示意图1：默认界面布局
标题: "AI-MATH 默认布局"
描述:

左侧DAG区域(27.5%): 显示有向无环图，节点表示解题步骤，边表示推导关系
中间解题区(45%): 上方显示题目块，下方显示多个解答块，每块有编号和LaTeX渲染公式
右侧AI面板(22.5%): 垂直排列三个面板 - LaTeX格式化(顶)、解释分析(中)、总结归纳(底)
每个面板有标题栏和控制按钮，呈现折叠状态

示意图2：AI面板激活状态
标题: "解释分析面板激活状态"
描述:

左侧: DAG区域折叠为窄条图标
中间: 解题区占50%宽度，显示题目和解答块
右侧: 解释分析面板扩展至50%宽度，显示完整界面

顶部: 面板标题"解释分析"和控制按钮
引用选择区: 解答块缩略图水平排列
中部: 对话区域显示问答内容
底部: 输入框和操作按钮



示意图3：DAG展开状态
标题: "DAG展开状态与问题探索模式"
描述:

左侧: DAG区域扩展至70%宽度，完整显示解题路径网络

右上角: 三个模式切换按钮(列表/问答/总结)，"问答"按钮高亮


右侧: 30%宽度显示问题探索界面

顶部: 选中节点信息
中部: 问答交互区域
底部: 输入框和建议问题


两区域间: 可拖动的分隔条

示意图4：@引用系统示例
标题: "@块引用系统交互"
描述:

面板输入框上方: 水平排列的解答块缩略图，每个缩略图左上角有编号
输入框: 显示"请分析@3-6中使用的积分技巧"
对话区: 引用块显示，包含原始解答块3-6的内容，带有独特背景色
下方: AI回答，分析引用块中的积分技巧

示意图5：从DAG到AI面板的交互
标题: "DAG节点到总结面板的数据流"
描述:

左侧(70%): DAG区域显示多路径解题网络，部分节点被选中高亮
右侧(30%): 总结归纳面板，正在处理选中节点的内容
交互元素: 从选中节点到右侧面板的虚线箭头，表示数据流
右侧面板: 生成中的解题路径对比分析

示意图6：布局调整演示
标题: "界面布局动态调整"
描述:

三画面同框展示，表示布局变化过程:

默认布局(左27.5%/中45%/右22.5%)
AI面板激活(左图标/中50%/右50%)
DAG展开(左70%/右30%)


各状态间有过渡箭头，标注触发条件
分隔条上有拖动指示，表示用户可调整比例

这些示意图描述了AI-MATH界面的关键状态和交互流程。您可以基于这些描述创建实际的UI示意图，或者使用Figma、Adobe XD等工具设计一个简单的原型，以便更生动地向他人展示这个设计概念。如果您需要更具体的设计指导或描述，请告诉我。
# AI-MATH 右侧AI模型面板详细设计说明

## 1. 右侧AI模型面板整体架构

### 1.1 基础布局
- **位置与尺寸**：位于界面右侧，默认状态下占整个界面宽度的22.5%
- **垂直分区**：三个垂直排列的功能面板，自上而下依次为：
  1. **LaTeX格式化面板**（顶部，约33%高度）
  2. **解释分析面板**（中部，约33%高度）
  3. **总结归纳面板**（底部，约33%高度）
- **分隔线**：面板之间有可拖动的分隔线，允许调整各面板的高度比例

### 1.2 布局联动机制
- **与中间解题区联动**：
  - 当任一AI面板被激活时，面板扩展至50%宽度
  - 同时中间解题区收缩为50%宽度
  - DAG区域自动折叠为图标状态
- **与DAG区域联动**：
  - 当DAG区域展开时，DAG占据70%宽度
  - 右侧AI功能区收缩为30%宽度
  - 此布局下有分隔条可拖动调整两区域比例
  - 右侧区域切换为三种模式之一（列表/问答/总结）

### 1.3 视觉风格
- **配色方案**：
  - LaTeX格式化面板：浅蓝色调（#E3F2FD背景，#1976D2强调色）
  - 解释分析面板：浅绿色调（#E8F5E9背景，#388E3C强调色）
  - 总结归纳面板：浅紫色调（#F3E5F5背景，#7B1FA2强调色）
- **字体规范**：
  - 面板标题：16px，半粗体
  - 内容文本：14px，常规
  - 数学公式：使用KaTeX/MathJax渲染

### 1.4 共享交互元素
- **面板控制按钮**：
  - 每个面板右上角有控制按钮组：
    - 展开/折叠按钮
    - 最大化/恢复按钮
    - 关闭/最小化按钮
- **激活状态**：
  - 当前激活的面板有轻微阴影和高亮边框
  - 未激活的面板略微降低不透明度（85%）
- **布局调整**：
  - 面板之间的分隔条可拖动调整高度
  - 双击分隔条重置为均等分布

## 2. 块引用系统设计

### 2.1 引用选择器UI
- **位置**：每个AI面板输入框正上方
- **外观**：水平滚动条，显示当前解题块的缩略图序列
- **缩略图设计**：
  - 尺寸：50px × 40px
  - 内容：解答块内容的简化预览
  - 编号：左上角显示块序号（如"1"、"2"、"3"）
  - 状态标识：正确(✓)/错误(✗)/未检验(?)
- **选择交互**：
  - 单击缩略图：选择单个块（生成@n引用）
  - 长按起点+拖动到终点：选择范围（生成@m-n引用）
  - 点击"从头选择"按钮：选择从第一块到指定块（生成@1-n引用）

### 2.2 @引用语法及功能
- **单块引用**：`@n`
  - 示例：`@3`表示引用第3个解答块
  - 功能：将该块的内容导入到当前AI面板分析
- **全前序引用**：`@1-n`
  - 示例：`@1-8`表示引用第1到第8个解答块
  - 功能：将完整解题路径导入，便于总体分析
- **指定范围引用**：`@m-n`
  - 示例：`@3-6`表示引用第3到第6个解答块
  - 功能：分析特定解题阶段
- **混合引用支持**：
  - 支持多段引用：`@2, @4-6, @8`
  - 快捷语法：`@上一步`、`@当前`、`@全部`

### 2.3 引用智能预览
- **引用预览**：输入@后显示智能下拉菜单
  - 显示可引用的块编号和内容预览
  - 高频引用组合的快捷选项
  - 最近使用的引用历史
- **引用自动补全**：
  - 输入@后根据数字自动匹配可能的块
  - 使用箭头键导航建议列表
  - Tab键接受建议

### 2.4 引用内容显示
- **插入形式**：被引用内容以引用块形式插入到对话流中
  - 引用块有明显边框和背景色区分
  - 块右上角显示来源标识（如"来自块3"）
- **交互选项**：
  - 展开/折叠按钮控制详细程度
  - 点击引用块可跳转到原始块位置
  - 右键菜单提供复制、分享等选项

## 3. LaTeX格式化面板详细设计

### 3.1 功能定位
- **核心目标**：优化数学表达式的LaTeX代码，提高可读性和规范性
- **适用场景**：
  - 格式化复杂或杂乱的数学表达式
  - 简化冗长的LaTeX代码
  - 标准化数学表达式风格
  - 修正语法错误和结构问题

### 3.2 面板结构
- **顶部区域**：
  - 面板标题："LaTeX格式化"
  - 控制按钮组
  - 格式化选项切换器（标准/简洁/教学）
- **引用选择器区**：
  - 显示解答块缩略图
  - 快速引用操作按钮
- **中央区域**：
  - 输入区：原始LaTeX代码（左）
  - 输出区：格式化后的代码与实时预览（右）
- **底部区域**：
  - 输入框：用于输入指令或修改要求
  - 操作按钮组：应用、复制、撤销、重做
  - 格式化建议提示

### 3.3 主要功能组件
- **代码分析器**：
  - 识别LaTeX结构和语法错误
  - 提供自动修复建议
  - 标记冗余或非标准表达式
- **格式优化器**：
  - 调整代码缩进和换行
  - 优化括号和分数表达式
  - 标准化数学符号使用
- **风格选择器**：
  - 提供多种数学表达式风格
  - 自定义格式化规则
  - 保存常用格式配置

### 3.4 交互流程
1. **引用或拖入内容**：
   - 用户使用@引用现有块
   - 或从中间解题区拖动块到面板
2. **布局调整**：
   - 面板自动扩展至50%宽度
   - 中间解题区收缩为50%宽度
   - DAG区域折叠为图标
3. **自动分析**：
   - 系统分析LaTeX代码结构
   - 识别潜在问题和优化机会
4. **格式化建议**：
   - 提供智能格式化建议
   - 显示改进预览对比
5. **用户调整**：
   - 用户接受建议或手动修改
   - 输入特定格式化指令
6. **应用变更**：
   - 将优化后的内容应用到原块
   - 或创建新的解答块

## 4. 解释分析面板详细设计

### 4.1 功能定位
- **核心目标**：提供深入的数学概念解释和解题思路分析
- **适用场景**：
  - 理解复杂的解题步骤
  - 学习相关数学概念
  - 分析解题思路的正确性
  - 解决解题过程中的困惑

### 4.2 面板结构
- **顶部区域**：
  - 面板标题："解释分析"
  - 控制按钮组
  - 分析模式选择器（概念/步骤/错误/综合）
- **引用选择器区**：
  - 显示解答块缩略图
  - 快速引用操作按钮
- **中央区域**：
  - 对话历史区：显示之前的解释和问答
  - 分析结果区：当前分析内容，分层结构
- **底部区域**：
  - 输入框：用于输入问题或分析请求
  - 智能提示区：推荐的问题和方向
  - 操作按钮：发送、清除、保存

### 4.3 主要功能组件
- **数学概念解析器**：
  - 识别步骤中的核心数学概念
  - 提供概念定义和应用说明
  - 关联相关定理和公式
- **推导步骤分析器**：
  - 验证推导逻辑的正确性
  - 解释每个转换的数学原理
  - 提供详细的中间步骤
- **错误诊断系统**：
  - 精确定位推导错误
  - 解释错误原因
  - 提供修正建议
- **交互式问答引擎**：
  - 理解上下文相关的问题
  - 提供精确针对性回答
  - 支持多轮深入讨论

### 4.4 交互流程
1. **内容引入**：
   - 用户使用@引用指定块
   - 或拖动特定解答块到面板
2. **布局调整**：
   - 面板自动扩展至50%宽度
   - 中间解题区收缩为50%宽度
   - DAG区域折叠为图标
3. **自动初步分析**：
   - 系统识别关键数学概念和方法
   - 生成推导步骤的初步解释
4. **分层信息呈现**：
   - 自动展开最相关的信息层级
   - 其他内容可按需展开
5. **交互式深入**：
   - 用户提出具体问题
   - AI提供针对性解答
   - 支持连续追问深入
6. **应用与反馈**：
   - 将理解应用到解题过程
   - 提供反馈改进解释质量

## 5. 总结归纳面板详细设计

### 5.1 功能定位
- **核心目标**：概括解题过程，提炼关键思路和方法
- **适用场景**：
  - 回顾完整解题思路
  - 提取解题的核心技巧
  - 比较不同解法路径
  - 生成学习笔记和总结

### 5.2 面板结构
- **顶部区域**：
  - 面板标题："总结归纳"
  - 控制按钮组
  - 总结类型选择器（思路/要点/技巧/全面）
- **引用选择器区**：
  - 显示解答块缩略图
  - 快速引用操作按钮
- **中央区域**：
  - 总结内容区：根据选择的总结类型显示内容
  - 结构化视图：分层次、分类别的总结
- **底部区域**：
  - 定制选项：总结长度、风格、重点调整
  - 操作按钮：生成、更新、导出、分享
  - 反馈按钮：改进总结质量

### 5.3 主要功能组件
- **解题路径提炼器**：
  - 归纳整体解题策略
  - 识别关键转折点
  - 简化冗长步骤
- **核心技巧识别器**：
  - 提取解题中使用的特殊技巧
  - 标记通用方法和特例处理
  - 关联数学原理
- **对比分析引擎**：
  - 比较不同解题路径
  - 分析优缺点和适用场景
  - 效率和简洁度评估
- **知识点映射器**：
  - 将解题过程与教学大纲映射
  - 标识知识点覆盖情况
  - 生成知识点清单

### 5.4 交互流程
1. **内容选择**：
   - 默认选择整个解题过程（@全部）
   - 或用户指定特定范围（@m-n）
2. **布局调整**：
   - 面板自动扩展至50%宽度
   - 中间解题区收缩为50%宽度
   - DAG区域折叠为图标
3. **总结类型选择**：
   - 选择总结的侧重点和风格
   - 调整详细程度和组织结构
4. **生成总结**：
   - 系统分析解题路径
   - 提取核心内容和方法
   - 生成结构化总结
5. **交互调整**：
   - 用户可展开/折叠特定部分
   - 请求调整特定内容的详细程度
   - 添加个人注解
6. **导出与分享**：
   - 以各种格式导出总结
   - 生成分享链接或嵌入代码

## 6. DAG展开状态下的模式切换

### 6.1 基本布局与交互
- **DAG展开状态**：
  - DAG区域默认占据页面约70%宽度
  - 右侧区域占约30%宽度
  - 两区域间有可拖动分隔条，用户可调整比例
  - 分隔条双击恢复默认比例
- **模式切换按钮组**：
  - 位置：DAG区域右上角
  - 样式：三个并排图标按钮，当前激活的按钮高亮显示
  - 切换效果：点击切换按钮，右侧区域平滑切换到对应功能界面

### 6.2 三种模式详解

#### 6.2.1 原始解题列表模式
- **按钮图标**：表格/列表图标
- **功能定位**：查看与当前DAG节点对应的解题步骤列表
- **右侧区域内容**：
  - 顶部：当前路径标识和节点信息
  - 中部：以列表形式显示解题步骤
  - 底部：操作按钮（应用、复制、返回）
- **交互特性**：
  - 点击列表项可高亮对应DAG节点
  - 双击列表项可将该步骤内容填充到中间解题区
  - 支持多选和批量操作

#### 6.2.2 问题探索模式
- **按钮图标**：问号/对话图标
- **功能定位**：通过提问深入分析特定节点或路径
- **右侧区域内容**：
  - 顶部：选中节点信息
  - 中部：交互式问答界面
  - 底部：输入框和智能提示
- **交互特性**：
  - 从DAG中选择节点作为讨论对象
  - 围绕特定解题步骤或思路提问
  - 支持多轮对话深入探讨
  - 结果可保存为节点注释

#### 6.2.3 总结归纳模式
- **按钮图标**：概要/总结图标
- **功能定位**：对选定路径或节点集合进行总结
- **右侧区域内容**：
  - 顶部：选择范围控制器
  - 中部：生成的总结内容
  - 底部：总结选项和操作按钮
- **交互特性**：
  - 在DAG中圈选多个节点进行总结
  - 选择总结的类型和风格
  - 总结结果可保存为新节点
  - 支持导出和分享

### 6.3 从DAG到AI面板的数据流
- **节点选择机制**：
  - 单击选择单个节点
  - Ctrl+点击或框选选择多个节点
  - 路径选择：选择两个节点自动包含路径上的全部节点
- **数据传输方式**：
  - 拖拽传输：将节点拖到右侧区域
  - 右键菜单：选择"发送到AI分析"
  - 快捷键：选中后使用Ctrl+1/2/3发送到对应面板
- **上下文保留**：
  - 传输节点内容的同时保留节点关系
  - 自动包含必要的前置节点内容
  - 记录节点在DAG中的位置和路径信息

## 7. 实际应用场景示例

### 7.1 场景一：LaTeX格式优化

**用户目标**：优化一个复杂的数学表达式格式

**操作流程**：
1. 用户在中间解题区完成一个包含复杂积分的解答步骤
2. 注意到公式排版不够美观，拖动该解答块到右侧LaTeX格式化面板
3. 界面自动调整：面板扩展到50%宽度，中间区域收缩为50%
4. 系统提供格式优化建议，包括：
   - 优化括号大小和对齐
   - 调整分数表达式布局
   - 标准化数学符号使用
5. 用户接受建议或进行手动调整
6. 点击"应用"将优化后的内容更新回原解答块
7. 点击面板右上角"恢复"按钮，界面恢复默认布局

### 7.2 场景二：DAG节点分析

**用户目标**：分析DAG中特定解题路径的优缺点

**操作流程**：
1. 用户点击展开DAG区域（占70%宽度，右侧区域占30%）
2. 在DAG右上角点击"总结归纳"模式按钮
3. 在DAG中选择感兴趣的节点或路径
4. 右侧30%区域生成相关分析内容
5. 用户可通过拖动分隔条调整DAG和右侧区域的比例
6. 完成分析后，用户可折叠DAG区域，恢复默认布局

### 7.3 场景三：多块范围分析

**用户目标**：分析解题过程中的一段关键推导

**操作流程**：
1. 用户在解释分析面板中使用@引用选择特定范围（如@3-6）
2. 界面自动调整：面板扩展到50%宽度，中间区域收缩为50%
3. 系统分析选定的多个解答块，识别关键概念和推导逻辑
4. 用户通过提问深入了解特定步骤
5. 在分析完成后，用户可以将关键洞见应用到解题中
6. 点击面板右上角"恢复"按钮，界面恢复默认布局

## 8. 关键设计要点总结

1. **智能布局联动**：
   - 与中间解题区联动：50%/50%比例
   - 与DAG区域联动：70%/30%比例，用户可调整
   - 所有布局变化都有平滑过渡效果

2. **三面板垂直架构**：右侧区域清晰划分为LaTeX格式化、解释分析和总结归纳三个功能面板，各司其职。

3. **高效的@块引用系统**：创新的@引用语法（@n、@1-n、@m-n）配合直观的缩略图选择器，实现对解题块的精确引用。

4. **DAG展开模式的三功能切换**：右上角按钮组控制右侧区域的功能模式（原始列表、问题探索、总结归纳）。

5. **丰富的交互方式**：支持拖拽引用、@语法引用、节点选择等多种内容传递方式，适应不同使用习惯。

6. **可拖动调整的界面比例**：用户可通过拖动分隔条自定义各区域比例，满足个性化需求。

通过这一设计，AI-MATH右侧AI模型面板与中间解题区和左侧DAG实现了智能联动，既能提供灵活的界面布局，又保持了清晰的功能边界，为用户创造高效直观的数学解题体验。